\documentclass[a4paper,oneside,11pt]{book}
\usepackage{NWUStyle}
\usepackage{titlesec} % For redefining chapter title format
\usepackage{listings}

% Redefine chapter and section spacing
\titlespacing{\chapter}{0pt}{-50pt}{5pt} % Adjust the spacing as needed
\titlespacing{\section}{0pt}{10pt}{5pt} % Adjust the spacing as needed

\titleformat{\chapter}[display]
{\normalfont\huge\bfseries}{}{0pt}{\Huge}

\begin{document}
\Title{Cryptography report}
\Initials{B.}
\FirstName{Bernard}
\Surname{Swanepoel}
\StudentNumber{39909476}
\Supervisor{Prof. Lynette Drevin}
\MakeTitle 
\pagenumbering{roman} 
\tableofcontents
\cleardoublepage 
\pagenumbering{arabic} 

\chapter[Vigenère cipher]{Vigenère cipher}
\section{Encrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool VigenereEncryptBinaryFile(string inputFile, 
string outputFile, string key)
{
    try
    {
        byte[] dataToEncrypt = File.ReadAllBytes(inputFile);
        byte[] encryptedData = new byte[dataToEncrypt.Length];

        for (int i = 0; i < dataToEncrypt.Length; i++)
        {
            // Apply the Vigenere cipher algorithm
            int shift = key[i % key.Length] - 'A'; 
            encryptedData[i] = (byte)((dataToEncrypt[i] + shift) 
            % 256);
        }

        File.WriteAllBytes(outputFile, encryptedData);
        fileExtension = GetFileExtension(inputFile);
        return true;
    }
    catch (Exception ex)
    {
        Console.WriteLine("Encryption failed: " + ex.Message);
        return false;
    }
}
\end{lstlisting}
\section{Decrypt}
\pagestyle{plain}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool VigenereDecryptBinaryFile(string inputFile, 
string outputFile, string key)
{
    try
    {
        byte[] dataToDecrypt = File.ReadAllBytes(inputFile);
        byte[] decryptedData = new byte[dataToDecrypt.Length];

        for (int i = 0; i < dataToDecrypt.Length; i++)
        {
            // Apply the Vigenere cipher algorithm
            int shift = key[i % key.Length] - 'A';
            decryptedData[i] = (byte)((dataToDecrypt[i] - shift + 256)
            % 256);
        }

        File.WriteAllBytes(outputFile, decryptedData);
        return true;
    }
    catch (Exception ex)
    {
        Console.WriteLine("Decryption failed: " + ex.Message);
        return false;
    }
}
\end{lstlisting}
Cite 1\citep{AUT2018}.\vspace{0.25cm}
\noindent Cite 2 \citep{AUT1999}
\chapter[Vernam Cipher]{Vernam Cipher}
\section{Encrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool VernamEncryptBinaryFile(string inputFile, 
string outputFile, string key)
{
    try
    {
        // Read all bytes from the input file
        byte[] dataToEncrypt = File.ReadAllBytes(inputFile);
        byte[] encryptedData = new byte[dataToEncrypt.Length];
    
        // Perform Vernam encryption
        for (int i = 0; i < dataToEncrypt.Length; i++)
        {
            // Apply the Vernam cipher algorithm
            encryptedData[i] = (byte)(dataToEncrypt[i] ^ key
            [i % key.Length]);
        }
    
         // Write the encrypted data to the output file
        File.WriteAllBytes(outputFile, encryptedData);
        fileExtension = GetFileExtension(inputFile);
        return true;
    }
    catch (Exception ex)
    {
        MessageBox.Show("Encryption failed: " + ex.Message);
        return false;
    }
}
\end{lstlisting}
\section{Decrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool VernamDecryptBinaryFile(string inputFile, 
string outputFile, string key)
{
    try
    {
        // Read all bytes from the input file
        byte[] dataToDecrypt = File.ReadAllBytes(inputFile);
        byte[] decryptedData = new byte[dataToDecrypt.Length];
    
        // Perform Vernam decryption
        //(same as encryption because it's symmetric)
        for (int i = 0; i < dataToDecrypt.Length; i++)
        {
            // Apply the Vernam cipher algorithm
            decryptedData[i] = (byte)(dataToDecrypt[i] ^ 
            key[i % key.Length]);
        }
    
        // Write the decrypted data to the output file
        File.WriteAllBytes(outputFile, decryptedData);
        return true;
    }
    catch (Exception ex)
    {
        MessageBox.Show("Decryption failed: " + ex.Message);
        return false;
    }
}
\end{lstlisting}
\chapter[Special cipher]{Special cipher}
\section{Encrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool EncryptFileHybrid(string inputFile, 
string outputFile)
{
    try
    {
        GenerateRSAKeys(); // Generate RSA keys before encryption
        byte[] aesKey = GenerateAESKey();
        byte[] encryptedAESKey = EncryptRSA(aesKey);
    
        byte[] dataToEncrypt = File.ReadAllBytes(inputFile);
    
        using (Aes aesAlg = Aes.Create())
        {
            aesAlg.Key = aesKey;
            aesAlg.GenerateIV(); // Generate IV
            byte[] iv = aesAlg.IV;
    
            using (MemoryStream ms = new MemoryStream())
            {
                // Write IV to the beginning of the MemoryStream
                ms.Write(iv, 0, iv.Length);
    
                using (CryptoStream cs = new CryptoStream
                (ms, aesAlg.CreateEncryptor(), CryptoStreamMode.Write))
                {
                    // Write encrypted data to the CryptoStream
                    cs.Write(dataToEncrypt, 0, dataToEncrypt.Length);
                    cs.FlushFinalBlock();
                }
                byte[] encryptedData = ms.ToArray();
    
                using (var combinedStream = new MemoryStream())
                {
                    combinedStream.Write(encryptedAESKey, 0, 
                    encryptedAESKey.Length);
                    combinedStream.Write(encryptedData, 0, 
                    encryptedData.Length);
    
                    File.WriteAllBytes(outputFile, combinedStream.ToArray());
                }
            }
        }
        fileExtension = GetFileExtension(inputFile);
        return true; // Encryption completed successfully
    }
    catch (Exception ex)
    {
        // Log the exception or display an error message
        MessageBox.Show("Encryption failed: " + ex.Message);
        return false; // Encryption failed
    }
}
\end{lstlisting}
\section{Decrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool DecryptFileHybrid(string inputFile, string outputFile)
{
    try
    {
        byte[] encryptedData = File.ReadAllBytes(inputFile);
        byte[] encryptedAESKey = new byte[256];
        byte[] encryptedDataWithoutKey = new byte
        [encryptedData.Length - 256];
    
        Array.Copy(encryptedData, encryptedAESKey, 256);
        Array.Copy(encryptedData, 256, encryptedDataWithoutKey, 
        0, encryptedData.Length - 256);
    
        byte[] aesKey = DecryptRSA(encryptedAESKey, privateKey);
    
        using (Aes aesAlg = Aes.Create())
        {
            aesAlg.Key = aesKey;
    
            // Extract IV from the beginning of the encryptedData
            byte[] iv = new byte[aesAlg.IV.Length];
            Array.Copy(encryptedDataWithoutKey, iv, aesAlg.IV.Length);
            aesAlg.IV = iv;
    
            using (MemoryStream ms = new MemoryStream(encryptedDataWithoutKey, 
            aesAlg.IV.Length, encryptedDataWithoutKey.Length - aesAlg.IV.Length))
            {
                using (CryptoStream cs = new CryptoStream(ms, 
                aesAlg.CreateDecryptor(), CryptoStreamMode.Read))
                {
                    using (MemoryStream decryptedStream = new MemoryStream())
                    {
                        cs.CopyTo(decryptedStream);
                        File.WriteAllBytes(outputFile, 
                        decryptedStream.ToArray());
                    }
                }
            }
        }
        return true;
    }
    catch (Exception ex)
    {
        MessageBox.Show("Decryption failed: " + ex.Message);
        return false;
    }
}
\end{lstlisting}
\chapter[RSA]{RSA}
\section{Encrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool EncryptFileRSA(string inputFile, string outputFile)
{
    try
    {
        GenerateRSAKeys(); // Generate RSA keys before encryption
        byte[] dataToEncrypt = File.ReadAllBytes(inputFile);
        List<byte[]> encryptedBlocks = new List<byte[]>();
    
        // Calculate the maximum block size for RSA encryption
        int blockSize = (publicKey.Modulus.Length / 8) - 11; 
    
        // Encrypt each block separately
        for (int i = 0; i < dataToEncrypt.Length; i += blockSize)
        {
            int remainingBytes = Math.Min(blockSize, dataToEncrypt.Length - i);
            byte[] blockToEncrypt = new byte[remainingBytes];
            Array.Copy(dataToEncrypt, i, blockToEncrypt, 0, remainingBytes);
    
            byte[] encryptedBlock = EncryptRSA(blockToEncrypt);
            encryptedBlocks.Add(encryptedBlock);
        }
    
        // Concatenate all encrypted blocks
        byte[] encryptedData = encryptedBlocks.SelectMany(x => x).ToArray();
        File.WriteAllBytes(outputFile, encryptedData);
        fileExtension = GetFileExtension(inputFile);
        return true; // Encryption completed successfully
    }
    catch (Exception ex)
    {
        // Log the exception or display an error message
        MessageBox.Show("Encryption failed: " + ex.Message);
        return false; // Encryption failed
    }
}
\end{lstlisting}
\section{Decrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
public static bool DecryptFileRSA(string inputFile, string outputFile)
{
    try
    {
        byte[] dataToDecrypt = File.ReadAllBytes(inputFile);
        byte[] decryptedData = DecryptRSA(dataToDecrypt, privateKey);
        File.WriteAllBytes(outputFile, decryptedData);
        return true;
    }
    catch(Exception ex)
    {
        MessageBox.Show("Decryption failed: " + ex.Message);
        return false;      
    }
}
\end{lstlisting}
\chapter[Caeser cipher]{Caeser cipher}
\section{Encrypt}
\begin{lstlisting}[language=Csh, caption={Endpoint to delete FITS file}]
private static byte CaesarCipher(byte inputByte, int key, bool encrypt)
{
    if (encrypt)
    {
        // Encryption: Shift the byte value by the key
        return (byte)((inputByte + key) % 256);
    }
    else
    {
        // Decryption: Shift the byte value backwards by the key
        return (byte)((inputByte - key + 256) % 256);
    }
}
    
// Function to encrypt or decrypt a binary file using the Caesar cipher
public static bool EncryptDecryptBinaryFile(string inputFile, string outputFile, int key, bool encrypt)
{
    try
    {
        // Open the input binary file for reading
        using (FileStream inputStream = new FileStream(inputFile, FileMode.Open))
        {
            // Create a new binary writer to write to the output file
            using (BinaryWriter outputFileWriter = new BinaryWriter(File.Open(outputFile, FileMode.Create)))
            {
                // Read and process each byte in the input file
                int byteRead;
                while ((byteRead = inputStream.ReadByte()) != -1)
                {
                    // Encrypt or decrypt the byte using the Caesar cipher
                    byte processedByte = CaesarCipher((byte)byteRead, key, encrypt);
    
                    // Write the processed byte to the output file
                    outputFileWriter.Write(processedByte);
                }
            }
        }
        if (GetFileExtension(inputFile) != ".bin")
        {
            fileExtension = GetFileExtension(inputFile);
        }
        return true;
    }
    catch (Exception ex)
    {
        // If any exception occurs, return false
        Console.WriteLine($"An error occurred: {ex.Message}");
        return false;
    }
}
\end{lstlisting}


\bibliography{MyBib}

\end{document}
